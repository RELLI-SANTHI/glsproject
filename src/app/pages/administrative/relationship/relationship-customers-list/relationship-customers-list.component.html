<div class="container-fluid p-0">
  <app-content-header
    (btnCreateEvent)="newRelation()"
    (btnExportEvent)="exportClientsData()"
    [disableExportBtn]="false"
    [image]="'assets/img/transparent/PNG-hands_relationship.png'"
    [labelBtnCreate]="'administrative.relationshipCustomerList.newRelation'"
    [isSmallMobile]="isSmallMobile()"
    [isTablet]="isTablet()"
    [showBtnCreate]="
      hasAccess(PROFILE.any, FUNCTIONALITY.networkAdministrativeCustomer, PERMISSION.write) ||
      hasAccess(PROFILE.any, FUNCTIONALITY.networkAdministrativeCustomerLAC, PERMISSION.write)
    "
    [showBtnExport]="true"
    [subTitle]="'administrative.relationshipCustomerList.subtitle'"
    [title]="getPageTitle()" />

  <hr />

  <gls-messages (downloadEvent)="downloadResponse()" />

  @if (isLoaded) {
    @if (
      listCustomersDraft().length &&
      (hasAccess(PROFILE.any, FUNCTIONALITY.networkAdministrativeCustomer, PERMISSION.write) ||
        hasAccess(PROFILE.any, FUNCTIONALITY.networkAdministrativeCustomerLAC, PERMISSION.write))
    ) {
      <h2 class="subtitle fw-bold fs-3">
        {{ 'structureList.draftTitle' | translate: { numberItems: listCustomersDraft().flat().length } }}
      </h2>

      <div class="d-flex flex-column">
        <app-carousel (clickEvent)="loadEditRelPage($event)" [listCarousel]="listCustomersDraft()">
          <ng-template let-slide>
            <div class="card-content w-100 d-flex flex-column justify-content-start align-items-start">
              <p
                class="card-code p-0 m-0 pb-1"
                ngbTooltip="{{ 'administrative.relationshipCustomerList.client' | translate }}"
                container="body">
                {{ 'administrative.relationshipCustomerList.client' | translate }}
              </p>
              <h3 class="visually-hidden">h3</h3>
              <h4 class="visually-hidden">h4</h4>
              <h5 class="card-title mb-0 p-0 m-0 pb-1" ngbTooltip="{{ slide.customerCode }}" container="body">
                {{ slide.customerCode }}
              </h5>
              <p [ngbTooltip]="slide.lastUpdated | date: 'dd/MM/yyyy HH:mm'" class="card-info p-0 m-0 pb-1 fs-6 text-break">
                {{ slide.lastUpdated | date: 'dd/MM/yyyy HH:mm' }}
              </p>
            </div>
          </ng-template>
        </app-carousel>
      </div>
    }

    <h2 class="subtitle fw-bold">{{ 'administrative.relationshipCustomerList.labelCustomerList' | translate }}</h2>

    <div class="container-fluid row my-3">
      <div class="col d-flex flex-column flex-md-row gap-2 justify-content-md-end">
        <button
          *ngIf="
            hasAccess(PROFILE.any, FUNCTIONALITY.networkAdministrativeCustomer, PERMISSION.write) ||
            hasAccess(PROFILE.any, FUNCTIONALITY.networkAdministrativeCustomerLAC, PERMISSION.write)
          "
          (click)="openModalSubAgents()"
          (keyup.enter)="openModalSubAgents()"
          class="btn btn-outline-secondary text-nowrap">
          <em class="bi bi-arrow-repeat"></em>
          {{ 'administrative.relationshipCustomerList.massiveAgentReplacement' | translate }}
        </button>

        <button
          *ngIf="hasAccess(PROFILE.any, FUNCTIONALITY.networkAdministrativeReplaceBank, PERMISSION.write)"
          (click)="openModalSubBanks()"
          (keyup.enter)="openModalSubBanks()"
          class="btn btn-outline-secondary text-nowrap">
          <em class="bi bi-arrow-repeat"></em>
          {{ 'administrative.relationshipCustomerList.massiveBankReplacement' | translate }}
        </button>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row">
        <div [ngClass]="{ 'd-flex': !isSmallMobile() }" class="col-12 order-2 order-md-1 p-0">
          <button (click)="openSidebar()" class="btn btn-link pe-4">
            <b><em class="bi bi-filter pe-1"></em>{{ 'userProfile.userList.filter' | translate }}</b>
          </button>
          <div [ngClass]="{ 'd-flex': !isSmallMobile(), 'filter-tablet-ratio': isTablet() }">
            <form (submit)="filterByAcronym()" [formGroup]="customersListFg" class="input-group">
              <div class="input-group">
                <div
                  [ngClass]="isSmallMobile() ? 'flex-column gap-2 w-100' : 'input-group-prepend align-items-center gap-3'"
                  class="d-flex">
                  <gls-input-dropdown
                    [controlName]="'filterType'"
                    [formGroup]="customersListFg"
                    [id]="'filterStyle'"
                    [keyDecsName]="'value'"
                    [keyValue]="'id'"
                    [options]="filterCustomersList"
                    [required]="false"
                    [showError]="false"
                    [showStatus]="false"
                    (change)="onFilterTypeChange($event)">
                  </gls-input-dropdown>

                  <gls-input
                    [class]="'form-control'"
                    [controlName]="'filterValue'"
                    [formGroup]="customersListFg"
                    [placeholder]="'structureList.search'"
                    [showError]="false"
                    [type]="inputType">
                  </gls-input>

                  <button
                    (click)="filterByAcronym()"
                    [disabled]="customersListFg.invalid || customersListFg.get('filterValue')?.value?.length < 1"
                    class="btn btn-primary"
                    type="button">
                    {{ 'structureList.search' | translate }}
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <app-badge-filters (resetFilters)="resetFilters($event)" [showFiltersApplied]="Array.from(badgeFilters)" />

    <app-relationship-list-table
      (itemIdSelected)="loadDetailRelPage($event)"
      (pageChange)="pageChange($event)"
      (sort)="onSort($event)"
      [currentPage]="currentPage()"
      [isAgent]="false"
      [listRelationships]="listCustomers()"
      [nameFirstColumn]="firstCol()"
      [pageSize]="pageSize()"
      [relationshipType]="relationshipType"
      [showRotateRelaship]="showRotateRelaship()"
      [totalItems]="totalItems()"
      [totalPages]="totalPages()" />
  }
</div>

@if (showSidebar()) {
  <app-filter-sidebar [filters]="filters" (closeSideBarEv)="closeSidebar()" (applyFiltersEv)="applyFilters($event)" />
}
