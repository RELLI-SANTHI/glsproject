<div class="sidebar-container">
  <div class="sidebar-content p-3 d-flex flex-column justify-content-between">
    <div class="d-flex flex-column m-2">
      <div class="d-flex align-items-center mb-3">
        @if (activeFilter) {
          <button
            (click)="backToList()"
            (keyup.enter)="backToList()"
            class="btn btn-link btn-round"
            aria-label="Back to filter list"
            type="button">
            <i class="bi bi-chevron-left yellow me-2"></i>
          </button>
        }
        <h3 class="subtitle white">
          {{ getTranslateLabel(activeFilter?.name) | translate }}
        </h3>
        <button
          (click)="closeFilters()"
          (keyup.enter)="closeFilters()"
          aria-label="Close filter"
          class="btn btn-round btn-link ms-auto"
          type="button">
          <em class="bi bi-x-lg yellow"></em>
        </button>
      </div>

      <div class="overflow-y-auto custom-filter-height">
        <!-- Lista filtri -->
        @if (!activeFilter) {
          <ng-container>
            @for (filter of filters(); track filter) {
              <div class="my-3">
                <button
                  (click)="openFilter(filter)"
                  (keyup.enter)="openFilter(filter)"
                  class="btn btn-link w-100 d-flex justify-content-between align-items-center"
                  aria-label="Open filter options"
                  type="button">
                  <span class="white underline text-start">
                    {{ filter.name | translate }}
                  </span>
                  <div class="d-flex ms-2">
                    <button
                      [ngClass]="{
                        'btn-warning': filter.selected !== undefined,
                        'btn-light': filter.selected === undefined
                      }"
                      class="btn btn-sm w-20 me-2 primary">
                      {{ getTranslateLabel(filter.selected, true) | translate }}
                    </button>
                    <i class="bi bi-chevron-right white my-auto"></i>
                  </div>
                </button>
              </div>
            }
          </ng-container>
        }

        <!-- List options -->
        @if (activeFilter) {
          <ng-container>
            @if (activeFilter.showSearch) {
              <input
                [(ngModel)]="searchTerm"
                class="form-control my-2"
                placeholder="{{ 'generic.search' | translate }} {{ activeFilter.name | translate }}"
                type="text" />
            }
            <ul class="list-group">
              @for (option of activeFilter.options | filter: searchTerm; track option) {
                <li class="list-group-item bg-transparent border-0 p-0">
                  <button
                    class="btn btn-link w-100 d-flex justify-content-between align-items-center text-start my-3"
                    type="button"
                    (click)="applySelection(option)"
                    (keyup.enter)="applySelection(option)">
                    <span class="white underline">{{ option | translate }}</span>
                  </button>
                </li>
              }
            </ul>
          </ng-container>
        }
      </div>
    </div>

    <div class="m-3">
      <button
        (click)="applyFilters()"
        (keyup.enter)="applyFilters()"
        aria-label="Apply filter"
        class="btn btn-warning w-100 btn-round"
        type="button">
        {{ 'structureList.applyFilter' | translate }}
      </button>
    </div>
  </div>
</div>
